rem -------------------
rem -- Sets up the main screen
rem --
rem -- @param byte draw_background!
rem -- Sets whether the background is to be drawn
rem ------------------.

proc setup_screen(draw_background!)
  memset \SCREEN, 1000, 32
  memset \SCREEN + 24 * 40, 40, 32 + 128

  memset \COLOR, 200, 5
  
  poke 55385, 2 : poke 55386, 2
  memset 55423, 4, 2
  
  poke 55338, 2
  poke 55339, 7
  poke 55340, 7
  
  length = 200 + draw_background! * 440
  memcpy @dashboard!, \SCREEN, length
  
  if draw_background! = 1 then
    memset \COLOR + 200, 440, 9
    memset $d9ed, 15, 2
  endif
  
  for i! = 0 to 199
    poke \SCREEN + i!, dashboard![i!]
  next i!
  
  for n = \SCROLL_AREA_TOP to \SCROLL_AREA_BOTTOM
    poke n, 90
  next n

  loc = \CITY_MAP_DEFAULT_PTR_LEFT + 1
  for col! = 0 to 39
    for i! = 16 to 23
      poke 1024 + i! * 40 + col!, peek!(loc)
      inc loc
    next i!
  next col!
  
  textat 7, 3, \hiscore
  
  data dashboard![] = ~
    32,199,  6, 21,  5, 12, 32, 32, 32, 32, 32, 32, 18,  1,  4,  1, 18, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,  6, 12,  5,  5, 20, 32, 32, 32,206, 32, ~
    32,199, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 184,190,190,190,190,190,190,190,190,190,190,190,190,190,190,185, 32, 32,182,176, 32, 32, 32, 32, 32, 32,206, 32, ~
    32,199, 19,  3, 15, 32, 32,  8,  9, 32, 32, 32, 188, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,189, 32, 32,183,177,163,164,150,151,166,167,206, 32, ~
    32,199, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 187,191,191,191,191,191,191,192,193,191,191,191,191,191,191,186, 32, 32, 32, 48, 48, 32, 32, 48, 48, 32,206, 32, ~
    32,205,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,207, 32

  data background_graphics![] = ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,211, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,210, 32, 32, 32, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,211, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, ~
    32,211, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,227,228,229,231, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 210, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,243,244,245,246, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,152,153,154,158, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,238,239,254,255, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, ~
    32, 32, 32, 32, 32, 32, 32,211, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,210, 32, 32, 32, 32, 32, 32, 32, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,210, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,211, 32, 32, 32, ~
    32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 211,32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, ~
    32, 32, 32,210, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32
    
endproc
